<?phpinclude_once '../bootstrap/init.php';$today = new fDate('today');$idDriver = fRequest::get('idDriver', 'integer');$dateBegin = fRequest::get('dateBegin', 'string', $today->format('Y-m-d'), true);$dateEnd = fRequest::get('dateEnd', 'string',  $today->format('Y-m-d'), true);?><!doctype html><html lang="es">	<head>		<meta charset="utf-8">		<title>Pedidos por chofer</title>		<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">		<script src="//code.jquery.com/jquery-1.10.2.js"></script>		<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>	</head>	<body>		<form action="">			<select id="selectDriver" name="idDriver">				<option value="0">Seleccionar chofer</option>				<?php 				$drivers = Admin::getAll(array('id_role=' => 10, 'status=' => 1), array('name' => 'ASC'));				foreach ($drivers as $driver): 				?>				<option value="<?=$driver->getIdAdmin()?>" <?php if ($idDriver == $driver->getIdAdmin()): ?>selected<?php endif; ?>><?=$driver->getName()?></option>				<?php endforeach; ?>			</select>			<p>Fecha inicio: <input type="text" id="dateBegin" class="datepicker" name="dateBegin" value="<?=$dateBegin?>"></p>			<p>Fecha fin: <input type="text" id="dateEnd" class="datepicker" name="dateEnd" value="<?=$dateEnd?>"></p>			<button type="submit">Buscar</button>		</form>		<?php		try {			$driver = new Admin($idDriver);			$driverName =  $driver->getName();		} catch(Exception $e) {			$driver = false;			$driverName = 'Sin chofer';		}		?>		<h3 style="margin-bottom: 10px;"><?=$driverName?><h3>		<div style="width: 100%;">			<div style="width: 48%; margin-bottom: 20px; float: left;">				<h3 style="margin-top: 0px; margin-bottom: 10px;">Confirmados<h3>				<table style="width: 100%; border: 1px solid #CCC; font-size: 15px;">					<thead>						<tr>							<th style="width: 10% !important;">Bultos</th>							<th style="width: 10% !important;">Piezas</th>							<th style="width: 68% !important;">Producto</th>							<th style="width: 12% !important;">Total</th>						</tr>					</thead>					<tbody>						<?php						$totalRequisition = new fNumber(0, 2);						$requisitionDescriptions = fORMDatabase::retrieve()->query("							SELECT SUM(quantity) as quantity, description, SUM(total) as total, quantity_unit_measure							FROM requisition_description							WHERE id_requisition IN (SELECT id_requisition FROM requisition WHERE id_driver = $idDriver AND requisition_date BETWEEN '$dateBegin' AND '$dateEnd')							AND status = 2							GROUP BY id_product, price							ORDER BY description ASC						")->asObjects();												foreach ($requisitionDescriptions as $requisitionDescription): 							$total = new fNumber($requisitionDescription->total, 2);							$quantityUnitMeasure = $requisitionDescription->quantity_unit_measure;							$pieces = $requisitionDescription->quantity;							$packages = (int) ($pieces / $quantityUnitMeasure);							$pieces -= $packages * $quantityUnitMeasure;							$totalRequisition = $totalRequisition->add($total);						?>						<tr>							<td><?=$packages?></td>							<td><?=$pieces?></td>							<td><?=$requisitionDescription->description?></td>							<td style="text-align: right;">$<?=$total->format()?></td>						</tr>						<?php endforeach; ?>						<tr>							<td colspan="3" style="text-align: right;">Total:</td>							<td style="text-align: right;">$<?=$totalRequisition->format()?></td>						</tr>					</tbody>				</table>			</div>			<div style="width: 48%; margin-bottom: 20px; margin-left: 2%; float: left;">				<h3 style="margin-top: 0px; margin-bottom: 10px;">Sin Confirmar<h3>				<table style="width: 100%; border: 1px solid #CCC; font-size: 15px;">					<thead>						<tr>							<th style="width: 10% !important;">Bultos</th>							<th style="width: 10% !important;">Piezas</th>							<th style="width: 68% !important;">Producto</th>							<th style="width: 12% !important;">Total</th>						</tr>					</thead>					<tbody>						<?php						$totalRequisition = new fNumber(0, 2);						$requisitionDescriptions = fORMDatabase::retrieve()->query("							SELECT SUM(quantity) as quantity, description, SUM(total) as total, quantity_unit_measure							FROM requisition_description							WHERE id_requisition IN (SELECT id_requisition FROM requisition WHERE id_driver = $idDriver AND requisition_date BETWEEN '$dateBegin' AND '$dateEnd')							AND status = 1							GROUP BY id_product, price							ORDER BY description ASC						")->asObjects();												foreach ($requisitionDescriptions as $requisitionDescription): 							$total = new fNumber($requisitionDescription->total, 2);							$quantityUnitMeasure = $requisitionDescription->quantity_unit_measure;							$pieces = $requisitionDescription->quantity;							$packages = (int) ($pieces / $quantityUnitMeasure);							$pieces -= $packages * $quantityUnitMeasure;							$totalRequisition = $totalRequisition->add($total);						?>						<tr>							<td><?=$packages?></td>							<td><?=$pieces?></td>							<td><?=$requisitionDescription->description?></td>							<td style="text-align: right;">$<?=$total->format()?></td>						</tr>						<?php endforeach; ?>						<tr>							<td colspan="3" style="text-align: right;">Total:</td>							<td style="text-align: right;">$<?=$totalRequisition->format()?></td>						</tr>					</tbody>				</table>			</div>			<div style="clear: both;"></div>		</div>	</body></html><script>	$(function() {		// $('#selectDriver').change(function(){			// window.location = '?idDriver=' + $(this).val() + '&dateBegin=' + $('#dateBegin').val() + '&dateBegin=' + $('#dateBegin').val();		// });				$('.datepicker').datepicker({			dateFormat: 'yy-mm-dd'		});	});</script>